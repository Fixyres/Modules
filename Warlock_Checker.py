import contextlib
import logging
import re
import base64
from typing import Union, List, Dict, Tuple

import requests

from .. import loader, utils

logger = logging.getLogger(__name__)

# –ü–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
encryption_patterns = {
    "pyarmor": r"__pyarmor__",
    "marshal": r"import\s+marshal",
    "zlib": r"import\s+zlib",
    "lzma": r"import\s+lzma",
    "bz2": r"import\s+bz2",
    "compile": r"compile\s*\([^)]*\)"
}

checker_regex = {
    "critical": [
        {
            "command": "DeleteAccountRequest", 
            "perms": "–º–æ–∂–µ—Ç —É–¥–∞–ª–∏—Ç—å –≤–∞—à –∞–∫–∫–∞—É–Ω—Ç Telegram", 
            "details": "–≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–∏—Ç—å –≤–∞—à –∞–∫–∫–∞—É–Ω—Ç Telegram –±–µ–∑ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è"
        },
        {
            "command": "edit_2fa", 
            "perms": "–º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å –≤–∞—à –ø–∞—Ä–æ–ª—å –¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏", 
            "details": "–ú–æ–¥—É–ª—å —Å–ø–æ—Å–æ–±–µ–Ω –º–µ–Ω—è—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –≤–∞—à–µ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞, –≤–∫–ª—é—á–∞—è –ø–∞—Ä–æ–ª—å –¥–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏"
        },
        {
            "command": "get_me", 
            "perms": "–º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º –≤–∞—à–µ–≥–æ –ø—Ä–æ—Ñ–∏–ª—è", 
            "details": "–ü–æ–ª—É—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ –≤–∞—à–∏–º –ª–∏—á–Ω—ã–º –¥–∞–Ω–Ω—ã–º: –∏–º–µ–Ω–∏, —Ñ–æ—Ç–æ –ø—Ä–æ—Ñ–∏–ª—è, —Å—Ç–∞—Ç—É—Å—É –∏ –¥—Ä—É–≥–∏–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º"
        },
        {
            "command": "disconnect", 
            "perms": "–º–æ–∂–µ—Ç –æ—Ç–∫–ª—é—á–∏—Ç—å –≤–∞—à –∞–∫–∫–∞—É–Ω—Ç –æ—Ç Telegram", 
            "details": "–ú–æ–∂–µ—Ç –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ —Ä–∞–∑–æ—Ä–≤–∞—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –≤–∞—à–µ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞ —Å —Å–µ—Ä–≤–µ—Ä–∞–º–∏ Telegram"
        },
        {
            "command": "log_out", 
            "perms": "–º–æ–∂–µ—Ç –≤—ã–π—Ç–∏ –∏–∑ –≤–∞—à–µ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞", 
            "details": "–°–ø–æ—Å–æ–±–µ–Ω –∑–∞–≤–µ—Ä—à–∏—Ç—å —Ç–µ–∫—É—â—É—é —Å–µ—Å—Å–∏—é, –≤—ã–π–¥—è –∏–∑ –≤–∞—à–µ–≥–æ –∞–∫–∫–∞—É–Ω—Ç–∞"
        },
        {
            "command": "ResetAuthorizationRequest", 
            "perms": "–º–æ–∂–µ—Ç —Å–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –≤–∞—à–∏ –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏", 
            "details": "–ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–≤–µ—Ä—à–∏—Ç—å –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —Å–µ—Å—Å–∏–∏ –Ω–∞ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö, –≥–¥–µ –≤—ã –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã"
        },
        {
            "command": "GetAuthorizationsRequest", 
            "perms": "–º–æ–∂–µ—Ç —É–∫—Ä–∞—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞ –≤ –≤–∞—à –∞–∫–∫–∞—É–Ω—Ç", 
            "details": "–ü–æ–ª—É—á–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤—Å–µ—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö, –≥–¥–µ –≤—ã –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã, —á—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ –¥–ª—è –∫—Ä–∞–∂–∏ –∞–∫–∫–∞—É–Ω—Ç–∞"
        },
        {
            "command": "AddRequest", 
            "perms": "–º–æ–∂–µ—Ç —É–∫—Ä–∞—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è –≤—Ö–æ–¥–∞ –≤ –≤–∞—à –∞–∫–∫–∞—É–Ω—Ç", 
            "details": "–ü–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤—ã–µ —Å–µ—Å—Å–∏–∏ –¥–æ—Å—Ç—É–ø–∞ –∫ –≤–∞—à–µ–º—É –∞–∫–∫–∞—É–Ω—Ç—É –±–µ–∑ –≤–∞—à–µ–≥–æ –≤–µ–¥–æ–º–∞"
        },
        {
            "command": "pyarmor", 
            "perms": "—Å–æ–¥–µ—Ä–∂–∏—Ç –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥ - –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–º", 
            "details": "–ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞, —á—Ç–æ –º–æ–∂–µ—Ç —Å–∫—Ä—ã–≤–∞—Ç—å –æ–ø–∞—Å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏"
        },
        {
            "command": "pyrogram", 
            "perms": "–∏—Å–ø–æ–ª—å–∑—É–µ—Ç –¥—Ä—É–≥–æ–π –∫–ª–∏–µ–Ω—Ç Telegram - –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–ø–∞—Å–Ω–æ", 
            "details": "–ü—Ä–∏–º–µ–Ω—è–µ—Ç –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π –∫–ª–∏–µ–Ω—Ç Telegram, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –º–µ–Ω—å—à–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏"
        },
        {
            "command": "system|os\\.system", 
            "perms": "–º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –ª—é–±—ã–µ –∫–æ–º–∞–Ω–¥—ã –Ω–∞ –≤–∞—à–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ", 
            "details": "–ü–æ–ª—É—á–∞–µ—Ç –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—é —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ –Ω–∞ –≤–∞—à–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ"
        },
        {
            "command": "eval", 
            "perms": "–º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ª—é–±–æ–π Python –∫–æ–¥ –Ω–∞ –≤–∞—à–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ", 
            "details": "–ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –ª—é–±–æ–π –∫–æ–¥ Python –±–µ–∑ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π, —á—Ç–æ –æ—á–µ–Ω—å –æ–ø–∞—Å–Ω–æ"
        },
        {
            "command": "exec", 
            "perms": "–º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ª—é–±–æ–π Python –∫–æ–¥ –Ω–∞ –≤–∞—à–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ", 
            "details": "–ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ eval, –¥–∞—ë—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤—ã–ø–æ–ª–Ω—è—Ç—å –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π –∫–æ–¥ Python"
        },
        {
            "command": "sessions", 
            "perms": "–º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –≤–∞—à–∏–º —Å–µ—Å—Å–∏—è–º Telegram", 
            "details": "–ü–æ–ª—É—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —Ñ–∞–π–ª–∞–º –≤–∞—à–∏—Ö —Å–µ—Å—Å–∏–π, —á—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ –¥–ª—è –∫—Ä–∞–∂–∏ –∞–∫–∫–∞—É–Ω—Ç–∞"
        },
        {
            "command": "subprocess", 
            "perms": "–º–æ–∂–µ—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å –ª—é–±—ã–µ –∫–æ–º–∞–Ω–¥—ã –Ω–∞ –≤–∞—à–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ", 
            "details": "–ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –ª—é–±—ã–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –Ω–∞ –≤–∞—à–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ"
        },
        {
            "command": "torpy", 
            "perms": "–º–æ–∂–µ—Ç —Å–∫–∞—á–∏–≤–∞—Ç—å –æ–ø–∞—Å–Ω—ã–µ —Ñ–∞–π–ª—ã —á–µ—Ä–µ–∑ TOR", 
            "details": "–ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–µ—Ç—å TOR –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è —Ñ–∞–π–ª–æ–≤, –æ–±—Ö–æ–¥—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –∏ —Å–∫—Ä—ã–≤–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å"
        },
        {
            "command": "httpimport", 
            "perms": "–º–æ–∂–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–π –∫–æ–¥ –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞", 
            "details": "–ü–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å –∏ –≤—ã–ø–æ–ª–Ω—è—Ç—å –∫–æ–¥ –Ω–∞–ø—Ä—è–º—É—é –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏"
        },
        {
            "command": "base64\\.|b64decode|b64encode", 
            "perms": "–∏—Å–ø–æ–ª—å–∑—É–µ—Ç —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ - –º–æ–∂–µ—Ç —Å–∫—Ä—ã–≤–∞—Ç—å –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã–π –∫–æ–¥", 
            "details": "–ü—Ä–∏–º–µ–Ω—è–µ—Ç –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ base64, –∫–æ—Ç–æ—Ä–æ–µ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –¥–ª—è —Å–æ–∫—Ä—ã—Ç–∏—è –æ–ø–∞—Å–Ω–æ–≥–æ –∫–æ–¥–∞"
        }
    ],
    "warn": [
        {
            "command": "list_sessions", 
            "perms": "–º–æ–∂–µ—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –≤–∞—à–∏ —Å–µ—Å—Å–∏–∏", 
            "details": "–ü–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –≤–∞—à–∏—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö —Å–µ—Å—Å–∏–π –≤ Telegram"
        },
        {
            "command": "LeaveChannelRequest", 
            "perms": "–º–æ–∂–µ—Ç –≤—ã—Ö–æ–¥–∏—Ç—å –∏–∑ –≤–∞—à–∏—Ö –≥—Ä—É–ø–ø –∏ –∫–∞–Ω–∞–ª–æ–≤", 
            "details": "–°–ø–æ—Å–æ–±–µ–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–∫–∏–¥–∞—Ç—å –≥—Ä—É–ø–ø—ã –∏ –∫–∞–Ω–∞–ª—ã –æ—Ç –≤–∞—à–µ–≥–æ –∏–º–µ–Ω–∏"
        },
        {
            "command": "JoinChannelRequest", 
            "perms": "–º–æ–∂–µ—Ç –ø–æ–¥–ø–∏—Å—ã–≤–∞—Ç—å—Å—è –Ω–∞ –≥—Ä—É–ø–ø—ã –∏ –∫–∞–Ω–∞–ª—ã –æ—Ç –≤–∞—à–µ–≥–æ –∏–º–µ–Ω–∏", 
            "details": "–ú–æ–∂–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω—è—Ç—å—Å—è –∫ –≥—Ä—É–ø–ø–∞–º –∏ –∫–∞–Ω–∞–ª–∞–º –±–µ–∑ –≤–∞—à–µ–≥–æ —Å–æ–≥–ª–∞—Å–∏—è"
        },
        {
            "command": "ChannelAdminRights", 
            "perms": "–º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –≤ –≤–∞—à–∏—Ö —á–∞—Ç–∞—Ö", 
            "details": "–ò–º–µ–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É–ø—Ä–∞–≤–ª—è—Ç—å –ø—Ä–∞–≤–∞–º–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ –≤ –≥—Ä—É–ø–ø–∞—Ö, –≥–¥–µ –≤—ã –∞–¥–º–∏–Ω"
        },
        {
            "command": "EditBannedRequest", 
            "perms": "–º–æ–∂–µ—Ç –±–∞–Ω–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –≤ –≤–∞—à–∏—Ö —á–∞—Ç–∞—Ö", 
            "details": "–°–ø–æ—Å–æ–±–µ–Ω –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –≥—Ä—É–ø–ø–∞—Ö –æ—Ç –≤–∞—à–µ–≥–æ –∏–º–µ–Ω–∏"
        },
        {
            "command": "remove|unlink", 
            "perms": "–º–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å —Ñ–∞–π–ª—ã —Å –≤–∞—à–µ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞", 
            "details": "–ò–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —É–¥–∞–ª–µ–Ω–∏—é —Ñ–∞–π–ª–æ–≤ –Ω–∞ –≤–∞—à–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ"
        },
        {
            "command": "rmdir|rmtree", 
            "perms": "–º–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å –ø–∞–ø–∫–∏ —Å –≤–∞—à–µ–≥–æ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞", 
            "details": "–ú–æ–∂–µ—Ç —É–¥–∞–ª—è—Ç—å —Ü–µ–ª—ã–µ –ø–∞–ø–∫–∏ —Å —Ñ–∞–π–ª–∞–º–∏ –Ω–∞ –≤–∞—à–µ–º —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ"
        },
        {
            "command": "telethon", 
            "perms": "–∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä—è–º–æ–π –¥–æ—Å—Ç—É–ø –∫ Telegram API", 
            "details": "–†–∞–±–æ—Ç–∞–µ—Ç –Ω–∞–ø—Ä—è–º—É—é —Å API Telegram, —á—Ç–æ –¥–∞—ë—Ç —à–∏—Ä–æ–∫–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è"
        },
        {
            "command": "get_response", 
            "perms": "–º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å –≤–∞—à–∏ —Å–æ–æ–±—â–µ–Ω–∏—è", 
            "details": "–ò–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É –≤–∞—à–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –≤ Telegram"
        }
    ],
    "info": [
        {
            "command": "requests", 
            "perms": "–æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç", 
            "details": "–ú–æ–∂–µ—Ç –æ–±–º–µ–Ω–∏–≤–∞—Ç—å—Å—è –¥–∞–Ω–Ω—ã–º–∏ —Å —Ä–∞–∑–Ω—ã–º–∏ –≤–µ–±-—Å–µ—Ä–≤–∏—Å–∞–º–∏"
        },
        {
            "command": "get_entity", 
            "perms": "–ø–æ–ª—É—á–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö", 
            "details": "–°–æ–±–∏—Ä–∞–µ—Ç –±–∞–∑–æ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è—Ö Telegram"
        },
        {
            "command": "get_dialogs", 
            "perms": "–ø–æ–ª—É—á–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –≤–∞—à–∏—Ö —á–∞—Ç–æ–≤", 
            "details": "–ú–æ–∂–µ—Ç –ø—Ä–æ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –≤–∞—à–∏—Ö –¥–∏–∞–ª–æ–≥–æ–≤ –≤ Telegram"
        },
        {
            "command": "os\\.path|os\\.name", 
            "perms": "–ø–æ–ª—É—á–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Å–∏—Å—Ç–µ–º–µ", 
            "details": "–°—á–∏—Ç—ã–≤–∞–µ—Ç –æ—Å–Ω–æ–≤–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≤–∞—à–µ–π –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º–µ"
        },
        {
            "command": "sys\\.", 
            "perms": "–ø–æ–ª—É—á–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ Python", 
            "details": "–ü–æ–ª—É—á–∞–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —Å–∏—Å—Ç–µ–º–Ω—ã–º —Ñ—É–Ω–∫—Ü–∏—è–º Python"
        },
        {
            "command": "import", 
            "perms": "–ø–æ–¥–∫–ª—é—á–∞–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏", 
            "details": "–ò—Å–ø–æ–ª—å–∑—É–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ Python –¥–ª—è —Å–≤–æ–µ–π —Ä–∞–±–æ—Ç—ã"
        },
        {
            "command": "client", 
            "perms": "–∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Ñ—É–Ω–∫—Ü–∏–∏ Telegram", 
            "details": "–í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤—É–µ—Ç —Å –æ—Å–Ω–æ–≤–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏ –∫–ª–∏–µ–Ω—Ç–∞ Telegram"
        },
        {
            "command": "send_message", 
            "perms": "–æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è", 
            "details": "–ú–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è —á–µ—Ä–µ–∑ –≤–∞—à –∞–∫–∫–∞—É–Ω—Ç"
        },
        {
            "command": "send_file", 
            "perms": "–æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ñ–∞–π–ª—ã", 
            "details": "–°–ø–æ—Å–æ–±–µ–Ω –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Ñ–∞–π–ª—ã —á–µ—Ä–µ–∑ Telegram"
        },
        {
            "command": "TelegramClient", 
            "perms": "—Å–æ–∑–¥–∞—ë—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Telegram", 
            "details": "–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç –Ω–æ–≤–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å —Å–µ—Ä–≤–µ—Ä–∞–º–∏ Telegram"
        },
        {
            "command": "download_file", 
            "perms": "—Å–∫–∞—á–∏–≤–∞–µ—Ç —Ñ–∞–π–ª—ã", 
            "details": "–ú–æ–∂–µ—Ç –∑–∞–≥—Ä—É–∂–∞—Ç—å —Ñ–∞–π–ª—ã –∏–∑ Telegram"
        },
        {
            "command": "ModuleConfig", 
            "perms": "–∏–º–µ–µ—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏", 
            "details": "–°–æ–¥–µ—Ä–∂–∏—Ç –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è —Ä–∞–±–æ—Ç—ã –º–æ–¥—É–ª—è"
        }
    ]
}

@loader.tds
class ModuleCheckerMod(loader.Module):
    """–° –ø–æ–º–æ—â—å—é –¥–∞–Ω–Ω–æ–≥–æ –º–æ–¥—É–ª—è –≤—ã –º–æ–∂–µ—Ç–µ –ø—Ä–æ–≤–µ—Ä—è—Ç—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ –º–æ–¥—É–ª–∏ –∫–∞–∫ –∏ –Ω–∞ –ø—Ä–æ—Å—Ç–æ —á—Ç–æ –æ–Ω –º–æ–∂–µ—Ç –¥–µ–ª–∞—Ç—å. –¢–∞–∫ –∏ –Ω–∞ —à–∏—Ñ—Ä–æ–≤–∫—É (—Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ base64 –∫–æ–¥–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–∞)\nü§ç–°–æ–∑–¥–∞—Ç–µ–ª—å - @OS7NT"""

    strings = {
        "name": "Warlock Checker",
        "description": "–°–æ–∑–¥–∞—Ç–µ–ª—å - @OS7NT",
        "loading": "üîÑ <b>–ü—Ä–æ–≤–µ—Ä—è—é –º–æ–¥—É–ª—å...</b>",
        "answer": "üîç <b>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–æ–¥—É–ª—è</b>:\n\n{findings}",
        "component": "‚Ä¢ {perms}",
        "error": (
            "‚ùå <b>–û—à–∏–±–∫–∞!</b>\n\n"
            "<i>–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å:</i>\n"
            "‚ñ´Ô∏è –û—Ç–ø—Ä–∞–≤—å—Ç–µ <code>.–ø</code> –∏ —Å—Å—ã–ª–∫—É –Ω–∞ –º–æ–¥—É–ª—å\n"
            "‚ñ´Ô∏è –û—Ç–≤–µ—Ç—å—Ç–µ –∫–æ–º–∞–Ω–¥–æ–π <code>.–ø</code> –Ω–∞ —Ñ–∞–π–ª –º–æ–¥—É–ª—è\n"
            "‚ñ´Ô∏è –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–∞–π–ª –º–æ–¥—É–ª—è —Å –∫–æ–º–∞–Ω–¥–æ–π <code>.–ø</code>"
        ),
        "no_findings": "‚Ä¢ –ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ",
        "base64_found": (
            "üîê <b>–û–±–Ω–∞—Ä—É–∂–µ–Ω –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π Base64 –∫–æ–¥!</b>\n"
            "<b>–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –∫–æ–¥–∞</b>:\n\n"
            "{findings}"
        ),
        "encryption_warning": (
            "‚ö†Ô∏è <b>–í–Ω–∏–º–∞–Ω–∏–µ! –í –º–æ–¥—É–ª–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã –º–µ—Ç–æ–¥—ã —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞:</b>\n"
            "{methods}\n"
            "‚ùóÔ∏è –ö–æ–¥ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ —Å–∫—Ä—ã—Ç –æ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ - –±—É–¥—å—Ç–µ –æ—Å—Ç–æ—Ä–æ–∂–Ω—ã!"
        ),
        "category_headers": {
            "critical": "‚õîÔ∏è <b>–û–ø–∞—Å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏</b> (–±—É–¥—å—Ç–µ –æ—Å—Ç–æ—Ä–æ–∂–Ω—ã!):\n",
            "warn": "‚ö†Ô∏è <b>–ü–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏</b> (–æ–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ):\n",
            "info": "‚ÑπÔ∏è <b>–û–±—ã—á–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏</b> (–Ω–µ –æ–ø–∞—Å–Ω–æ):\n"
        },
        "encryption_methods": {
            "pyarmor": "PyArmor",
            "marshal": "Marshal",
            "zlib": "Zlib",
            "lzma": "LZMA",
            "bz2": "BZ2",
            "compile": "–°–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥"
        }
    }

    def _format_findings(self, results: Dict[str, List[str]]) -> str:
        """–§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ –µ–¥–∏–Ω—ã–π —Ç–µ–∫—Å—Ç"""
        output = []
        for category in ["critical", "warn", "info"]:
            if results[category]:
                output.append(self.strings["category_headers"][category] + 
                            "\n".join(self.strings["component"].format(perms=perm)
                                    for perm in results[category]))
            else:
                output.append(self.strings["category_headers"][category] + 
                            self.strings["no_findings"])
        return "\n\n".join(output)

    def _find_base64(self, string: str) -> List[str]:
        """–ù–∞—Ö–æ–¥–∏—Ç base64 –∫–æ–¥ –≤ —Å—Ç—Ä–æ–∫–µ"""
        base64_pattern = r'(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{4})'
        potential_base64 = re.finditer(base64_pattern, string)
        decoded = []
        
        for match in potential_base64:
            encoded = match.group()
            if len(encoded) < 20:
                continue
                
            try:
                decoded_text = base64.b64decode(encoded).decode('utf-8')
                if all(ord(char) < 128 for char in decoded_text):
                    decoded.append(decoded_text)
            except:
                continue
                
        return decoded

    def _check_encryption_methods(self, code: str) -> List[str]:
        """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ–¥ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –º–µ—Ç–æ–¥–æ–≤ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è"""
        found_methods = []
        for method, pattern in encryption_patterns.items():
            if re.search(pattern, code, re.IGNORECASE):
                found_methods.append(self.strings["encryption_methods"][method])
        return found_methods

    async def _check_code(self, code: str) -> Dict[str, List[str]]:
        """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ–¥ –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤"""
        results = {
            "critical": set(),
            "warn": set(),
            "info": set()
        }
        
        for category in checker_regex:
            for item in checker_regex[category]:
                if re.search(item["command"], code, re.IGNORECASE):
                    results[category].add(item["perms"])
                    
        return {k: list(v) for k, v in results.items()}

    async def –øcmd(self, message):
        """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–æ–¥—É–ª—å –Ω–∞ –æ–ø–∞—Å–Ω—ã–π –∫–æ–¥"""
        await utils.answer(message, self.strings["loading"])
        
        args = utils.get_args_raw(message)
        code = None
        
        if args:
            try:
                r = await utils.run_sync(requests.get, args)
                code = r.text
            except Exception:
                pass
                
        if not code:
            try:
                code = (await self.client.download_file(message.media, bytes)).decode("utf-8")
            except Exception:
                try:
                    reply = await message.get_reply_message()
                    code = (await self.client.download_file(reply.media, bytes)).decode("utf-8")
                except Exception:
                    code = None

        if not code:
            await utils.answer(message, self.strings["error"])
            return

        response_lines = []

        # –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞ –º–µ—Ç–æ–¥—ã —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è
        encryption_methods = self._check_encryption_methods(code)
        if encryption_methods:
            response_lines.append(
                self.strings["encryption_warning"].format(
                    methods="\n".join(f"‚Ä¢ {method}" for method in encryption_methods)
                )
            )

        # –ò—â–µ–º base64 –∫–æ–¥
        decoded_texts = self._find_base64(code)
        if decoded_texts:
            # –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω base64, –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ–ª—å–∫–æ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥
            decoded_results = {"critical": set(), "warn": set(), "info": set()}
            for decoded in decoded_texts:
                results = await self._check_code(decoded)
                for category in results:
                    decoded_results[category].update(results[category])
                    
            decoded_results = {k: list(v) for k, v in decoded_results.items()}
            findings = self._format_findings(decoded_results)
            response_lines.append(
                self.strings["base64_found"].format(findings=findings)
            )
        else:
            # –ï—Å–ª–∏ base64 –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–≤–µ—Ä—è–µ–º –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥
            results = await self._check_code(code)
            findings = self._format_findings(results)
            response_lines.append(findings)

        # –§–æ—Ä–º–∏—Ä—É–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç
        await utils.answer(
            message,
            self.strings["answer"].format(
                findings="\n\n".join(response_lines)
            )
        )

    async def client_ready(self, client, db):
        self.client = client
        self.db = db